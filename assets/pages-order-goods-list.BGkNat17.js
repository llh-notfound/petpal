import{r as e,o as a,c as s,w as t,p as l,k as r,n as o,q as u,i as c,a as n,b as i,d,e as f,f as m,F as p,g as _,y as v,t as g,S as y,v as k,j as b,x as C,A as N,K as h}from"./index-BC-mzwrj.js";import{_ as x}from"./empty-order._VezAbnF.js";import"./index.U0t-2fq9.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const q=j({__name:"goods-list",setup(j){const q=["全部","待付款","待发货","待收货","已完成","售后"],P=e(0),w=e([]),I=e(!1),S=e(!1),$=e(1);e(10);const D=()=>{S.value=!0;if(!l("token"))return r({title:"请先登录",icon:"none"}),setTimeout((()=>{o({url:"/pages/login/login"})}),1500),void(S.value=!1);setTimeout((()=>{try{const a=[];try{const e=(l("orderList")||[]).filter((e=>"goods"===e.type));a.push(...e)}catch(e){console.error("获取本地订单数据失败:",e),a.push(...(u.mockOrderList||[]).filter((e=>"goods"===e.type)))}if(0===P.value)w.value=[...a];else{const e={1:"待付款",2:"待发货",3:"待收货",4:"已完成",5:"售后"};w.value=a.filter((a=>a.status===e[P.value]))}}catch(a){console.error("获取订单列表失败:",a),w.value=[]}finally{S.value=!1,I.value=!1}}),500)},L=()=>{!S.value&&I.value&&($.value++,D())},O=()=>{N()};return a((()=>{D()})),(e,a)=>{const l=d,u=c,N=b,j=C,S=y;return n(),s(u,{class:"goods-order-container"},{default:t((()=>[i(u,{class:"nav-bar"},{default:t((()=>[i(l,{class:"nav-title"},{default:t((()=>[f("宠物用品订单")])),_:1}),i(l,{class:"nav-back iconfont icon-back",onClick:O})])),_:1}),i(u,{class:"tab-bar"},{default:t((()=>[(n(),m(p,null,_(q,((e,a)=>i(u,{key:a,class:v(["tab-item",{active:P.value===a}]),onClick:e=>(e=>{P.value!==e&&(P.value=e,$.value=1,D())})(a)},{default:t((()=>[i(l,null,{default:t((()=>[f(g(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"]))),64))])),_:1}),i(S,{"scroll-y":"",class:"order-scroll-view",onScrolltolower:L},{default:t((()=>[0===w.value.length?(n(),s(u,{key:0,class:"empty-tip"},{default:t((()=>[i(N,{class:"empty-icon",src:x}),i(l,null,{default:t((()=>[f("暂无相关订单")])),_:1})])),_:1})):k("",!0),(n(!0),m(p,null,_(w.value,((e,a)=>(n(),s(u,{key:a,class:"order-item"},{default:t((()=>[i(u,{class:"order-header"},{default:t((()=>{return[i(l,{class:"order-number"},{default:t((()=>[f("订单号: "+g(e.orderNumber),1)])),_:2},1024),i(l,{class:v(["order-status",(a=e.status,{"待付款":"status-pending","待发货":"status-processing","待收货":"status-shipping","已完成":"status-completed","售后":"status-aftersale"}[a]||"")])},{default:t((()=>[f(g(e.status),1)])),_:2},1032,["class"])];var a})),_:2},1024),i(u,{class:"order-content"},{default:t((()=>[i(N,{class:"goods-image",src:e.image},null,8,["src"]),i(u,{class:"order-info"},{default:t((()=>[i(u,{class:"order-name"},{default:t((()=>[f(g(e.name),1)])),_:2},1024),i(u,{class:"order-specs"},{default:t((()=>[f(g(e.specs),1)])),_:2},1024),i(u,{class:"order-price"},{default:t((()=>[i(l,null,{default:t((()=>[f("¥"+g(e.price),1)])),_:2},1024),i(l,{class:"order-quantity"},{default:t((()=>[f("x"+g(e.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),i(u,{class:"order-footer"},{default:t((()=>[i(u,{class:"order-total"},{default:t((()=>[f("合计: ¥"+g(e.totalPrice),1)])),_:2},1024),i(u,{class:"order-actions"},{default:t((()=>["待付款"===e.status?(n(),s(j,{key:0,class:"action-btn primary-btn",onClick:a=>(e=>{{const a=encodeURIComponent(JSON.stringify({orderNumber:e.orderNumber,totalPrice:e.totalPrice,goodsInfo:{id:e.id||Date.now(),name:e.name,image:e.image,specs:e.specs,price:e.price,quantity:e.quantity}}));return void o({url:`/pages/order/confirm-order?orderData=${a}&fromPaymentPending=true`})}})(e)},{default:t((()=>[f("去付款")])),_:2},1032,["onClick"])):k("",!0),["待发货","待收货","已完成"].includes(e.status)?(n(),s(j,{key:1,class:"action-btn",onClick:a=>(e=>{o({url:`/pages/order/logistics?orderNumber=${e.orderNumber}`})})(e)},{default:t((()=>[f("查看物流")])),_:2},1032,["onClick"])):k("",!0),"待收货"===e.status?(n(),s(j,{key:2,class:"action-btn primary-btn",onClick:a=>(e=>{h({title:"确认收货",content:"确认已收到商品？",success:a=>{if(a.confirm){r({title:"确认收货成功",icon:"success"});const a=w.value.findIndex((a=>a.orderNumber===e.orderNumber));-1!==a&&(w.value[a].status="已完成")}}})})(e)},{default:t((()=>[f("确认收货")])),_:2},1032,["onClick"])):k("",!0),"已完成"===e.status?(n(),s(j,{key:3,class:"action-btn",onClick:a=>(e=>{o({url:`/pages/order/aftersale?orderNumber=${e.orderNumber}`})})(e)},{default:t((()=>[f("申请售后")])),_:2},1032,["onClick"])):k("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),I.value&&w.value.length>0?(n(),s(u,{key:1,class:"loading-more"},{default:t((()=>[i(l,null,{default:t((()=>[f("加载中...")])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-37874f4c"]]);export{q as default};
