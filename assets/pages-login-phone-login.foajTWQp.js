import{r as e,H as a,c as l,w as t,i as s,a as o,b as u,e as n,v as r,d as i,I as c,t as d,x as p,s as v,h as f,k as m,u as h,D as _,n as g,E as b,A as k,z as x,G as y}from"./index-BC-mzwrj.js";import{a as I}from"./index.U0t-2fq9.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=w({__name:"phone-login",setup(w){const V=e(""),C=e(""),L=e(""),j=e(""),A=e(0),U=e(null),N=a((()=>11===V.value.length&&!L.value)),T=a((()=>11===V.value.length&&6===C.value.length&&!L.value&&!j.value)),$=()=>{if(0===V.value.length)return void(L.value="");if(11!==V.value.length)return void(L.value="请输入11位手机号码");/^1[3-9]\d{9}$/.test(V.value)?L.value="":L.value="手机号格式不正确"},z=()=>{!N.value||A.value>0||(v({title:"发送中..."}),I.sendVerifyCode(V.value).then((e=>{f(),m({title:"验证码已发送",icon:"success"}),A.value=60,D()})).catch((e=>{f(),m({title:e.message||"发送验证码失败",icon:"none"})})))},D=()=>{clearInterval(U.value),U.value=setInterval((()=>{A.value--,A.value<=0&&clearInterval(U.value)}),1e3)},E=()=>{T.value&&(v({title:"登录中..."}),I.phoneLogin(V.value,C.value).then((e=>{f();const a=e.data;h("token",a.token),h("userInfo",JSON.stringify({token:a.token,userId:a.userId,nickname:a.nickname,avatar:a.avatar,memberLevel:a.memberLevel||"普通会员",petAvatar:a.petAvatar||"/static/images/pet.png"})),m({title:"登录成功",icon:"success"}),_("userLogin"),a.isNewUser?setTimeout((()=>{g({url:"/pages/profile/pet-info"})}),1500):setTimeout((()=>{try{const e=b();console.log("当前页面栈:",e),e.length>1?k({delta:2}):x({url:"/pages/profile/profile",fail:e=>{console.error("切换到个人中心失败:",e),y({url:"/pages/profile/profile"})}})}catch(e){console.error("导航错误:",e),x({url:"/pages/profile/profile"})}}),1500)})).catch((e=>{f(),m({title:e.message||"登录失败，请检查手机号和验证码",icon:"none"}),400===e.code&&(j.value="验证码错误")})))},G=()=>{k()};return(e,a)=>{const v=s,f=i,m=c,h=p;return o(),l(v,{class:"phone-login-container"},{default:t((()=>[u(v,{class:"form-container"},{default:t((()=>[u(v,{class:"form-title"},{default:t((()=>[n("手机号登录")])),_:1}),u(v,{class:"form-item"},{default:t((()=>[u(f,{class:"input-label"},{default:t((()=>[n("手机号")])),_:1}),u(v,{class:"input-wrapper"},{default:t((()=>[u(f,{class:"country-code"},{default:t((()=>[n("+86")])),_:1}),u(m,{class:"phone-input",type:"number",maxlength:"11",placeholder:"请输入手机号码",modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),onInput:$},null,8,["modelValue"])])),_:1}),L.value?(o(),l(f,{key:0,class:"error-tip"},{default:t((()=>[n(d(L.value),1)])),_:1})):r("",!0)])),_:1}),u(v,{class:"form-item"},{default:t((()=>[u(f,{class:"input-label"},{default:t((()=>[n("验证码")])),_:1}),u(v,{class:"input-wrapper code-wrapper"},{default:t((()=>[u(m,{class:"code-input",type:"number",maxlength:"6",placeholder:"请输入验证码",modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value=e)},null,8,["modelValue"]),u(h,{class:"send-code-btn",disabled:!N.value||A.value>0,onClick:z},{default:t((()=>[n(d(A.value>0?`重新发送(${A.value}s)`:"获取验证码"),1)])),_:1},8,["disabled"])])),_:1}),j.value?(o(),l(f,{key:0,class:"error-tip"},{default:t((()=>[n(d(j.value),1)])),_:1})):r("",!0)])),_:1}),u(h,{class:"login-btn",disabled:!T.value,onClick:E},{default:t((()=>[n("登录")])),_:1},8,["disabled"]),u(v,{class:"other-login-options"},{default:t((()=>[u(f,{class:"divider-text"},{default:t((()=>[n("其他登录方式")])),_:1}),u(v,{class:"other-options"},{default:t((()=>[u(v,{class:"wechat-option",onClick:G},{default:t((()=>[u(f,{class:"wechat-icon iconfont icon-wechat"}),u(f,{class:"option-text"},{default:t((()=>[n("微信")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-7b9723f1"]]);export{V as default};
