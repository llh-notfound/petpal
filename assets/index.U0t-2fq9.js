import{p as e,M as s,Q as o,n as a,L as t,q as n}from"./index-BC-mzwrj.js";const r="https://udrvmlsoncfg.sealosbja.site/api",d=(s,n="GET",d={},u=!1,i={})=>new Promise(((l,c)=>{const g={...i};if(u){const s=e("token");if(!s)return void c({code:401,message:"未授权，请先登录",data:null});g.Authorization=`Bearer ${s}`}t({url:r+s,method:n,data:d,header:g,success:e=>{200===e.statusCode?200===e.data.code?l(e.data):c(e.data):401===e.statusCode?(o("token"),o("userInfo"),c({code:401,message:"登录已过期，请重新登录",data:null}),setTimeout((()=>{a({url:"/pages/login/login"})}),1500)):c({code:e.statusCode,message:"请求失败",data:null})},fail:e=>{c({code:500,message:"网络错误，请检查网络连接",data:null})}})})),u=(e,s={},o=!1)=>{let a=e;if(Object.keys(s).length>0){a=`${e}?${Object.keys(s).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(s[e])}`)).join("&")}`}return d(a,"GET",{},o)},i=(e,s={},o=!1)=>d(e,"POST",s,o),l=(e,s={},o=!1)=>d(e,"PUT",s,o),c=(t,n,d="file",u={},i=!1)=>new Promise(((l,c)=>{const g={};if(i){const s=e("token");if(!s)return void c({code:401,message:"未授权，请先登录",data:null});g.Authorization=`Bearer ${s}`}s({url:r+t,filePath:n,name:d,formData:u,header:g,success:e=>{if(200===e.statusCode){const s=JSON.parse(e.data);200===s.code?l(s):c(s)}else 401===e.statusCode?(o("token"),o("userInfo"),c({code:401,message:"登录已过期，请重新登录",data:null}),setTimeout((()=>{a({url:"/pages/login/login"})}),1500)):c({code:e.statusCode,message:"上传失败",data:null})},fail:e=>{c({code:500,message:"网络错误，请检查网络连接",data:null})}})})),g={register:e=>i("/user/register",e),login:(e,s)=>i("/user/login",{username:e,password:s}),phoneLogin:(e,s)=>i("/user/phone-login",{phone:e,code:s}),sendVerifyCode:e=>i("/user/send-code",{phone:e}),wxLogin:(e,s={})=>i("/user/wxlogin",{code:e,userInfo:s}),getUserInfo:()=>u("/user/info",{},!0),updateUserInfo:e=>l("/user/update",e,!0),changePassword:(e,s)=>l("/user/change-password",{oldPassword:e,newPassword:s},!0),uploadAvatar:e=>c("/user/upload-avatar",e,"file",{},!0),logout:()=>i("/user/logout",{},!0)};console.log("正在使用模拟数据，API请求将被拦截"),g.login=e=>new Promise((e=>{setTimeout((()=>{const s=n.createMockUser({},!1);e({code:200,data:s,message:"登录成功"})}),500)})),g.register=e=>new Promise((s=>{setTimeout((()=>{const o=n.createMockUser({nickname:e.nickname||"新用户",phone:e.phone||"13800138000"},!1);s({code:200,data:o,message:"注册成功"})}),500)})),g.logout=()=>new Promise((e=>{setTimeout((()=>{n.logoutMockUser(!1),e({code:200,data:null,message:"退出成功"})}),300)})),g.getUserInfo=()=>new Promise((e=>{setTimeout((()=>{const s=n.getMockUserInfo();e({code:200,data:s,message:"获取成功"})}),300)}));export{g as a,u as g,i as p,c as u};
