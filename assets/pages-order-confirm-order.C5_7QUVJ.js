import{r as e,H as a,o as l,E as s,p as t,c as o,w as u,i as c,a as n,b as d,v as i,d as r,e as f,t as p,f as _,F as m,g as v,j as y,y as g,S as k,n as x,k as h,s as b,h as C,D as F,A,G as D}from"./index-BC-mzwrj.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=q({__name:"confirm-order",setup(q){const I=e([]),w=e(!1),S=e(null),j=e(null),J=[{id:"wechat",name:"微信支付",icon:"icon-wechat"},{id:"alipay",name:"支付宝支付",icon:"icon-alipay"}],N=e("wechat"),O=e([{id:1,name:"新用户优惠券",amount:10,minAmount:100,expireDate:"2023-12-31",scope:"全场通用"},{id:2,name:"宠物用品优惠券",amount:20,minAmount:200,expireDate:"2023-12-31",scope:"仅限宠物用品"},{id:3,name:"满减优惠券",amount:30,minAmount:300,expireDate:"2023-12-31",scope:"全场通用"}]),P=e(null),T=e(!1),E=e(null),G=e(10),H=a((()=>I.value.reduce(((e,a)=>e+a.price*a.quantity),0))),R=a((()=>{let e=H.value+G.value;return P.value&&(e-=P.value.amount),e>0?e:0})),U=()=>{x({url:"/pages/account/address"})},$=()=>{E.value=P.value,T.value=!0},z=()=>{E.value=null,T.value=!1},B=()=>{P.value=E.value,T.value=!1},K=()=>{j.value?(b({title:w.value?"支付中...":"提交中..."}),setTimeout((()=>{C();const e=w.value?"支付成功":"订单提交成功";h({title:e,icon:"success",duration:2e3,success:()=>{setTimeout((()=>{S.value&&void 0!==S.value.orderIndex?(F("orderPaid",{orderIndex:S.value.orderIndex}),A()):D({url:"/pages/order/goods-list"})}),2e3)}})}),1500)):h({title:"请选择收货地址",icon:"none"})};return l((()=>{var e;const a=s(),l=null==(e=a[a.length-1].$page)?void 0:e.options;if(l)if(l.fromPaymentPending){w.value=!0;try{if(l.orderData){const e=JSON.parse(decodeURIComponent(l.orderData));S.value=e;const a=e.goodsInfo;a&&(I.value=[{id:a.id,name:a.name,image:a.image,spec:a.specs,price:a.price,quantity:a.quantity}]),console.log("已加载来自待付款订单的数据:",I.value)}}catch(o){console.error("解析订单数据失败:",o)}}else try{const e=t("selected_cart_items");e&&(I.value=JSON.parse(e))}catch(o){console.error("获取订单商品数据失败",o)}else try{const e=t("selected_cart_items");e&&(I.value=JSON.parse(e))}catch(o){console.error("获取订单商品数据失败",o)}j.value={id:1,name:"张三",phone:"138****1234",province:"广东省",city:"深圳市",district:"南山区",detailAddress:"科技园1号楼101室",isDefault:!0}})),(e,a)=>{const l=r,s=c,t=y,x=k;return n(),o(s,{class:"confirm-order-container"},{default:u((()=>[d(s,{class:"address-section",onClick:U},{default:u((()=>[j.value?(n(),o(s,{key:0,class:"address-info"},{default:u((()=>[d(s,{class:"address-header"},{default:u((()=>[d(l,{class:"recipient-name"},{default:u((()=>[f(p(j.value.name),1)])),_:1}),d(l,{class:"recipient-phone"},{default:u((()=>[f(p(j.value.phone),1)])),_:1})])),_:1}),d(l,{class:"address-detail"},{default:u((()=>[f(p(j.value.province+j.value.city+j.value.district+j.value.detailAddress),1)])),_:1})])),_:1})):(n(),o(s,{key:1,class:"no-address"},{default:u((()=>[d(l,null,{default:u((()=>[f("请选择收货地址")])),_:1})])),_:1})),d(s,{class:"address-right"},{default:u((()=>[d(l,{class:"iconfont icon-right"})])),_:1})])),_:1}),d(s,{class:"order-goods-section"},{default:u((()=>[d(s,{class:"section-title"},{default:u((()=>[f("商品信息")])),_:1}),d(s,{class:"goods-list"},{default:u((()=>[(n(!0),_(m,null,v(I.value,((e,a)=>(n(),o(s,{class:"goods-item",key:a},{default:u((()=>[d(t,{src:e.image,mode:"aspectFill",class:"goods-image"},null,8,["src"]),d(s,{class:"goods-info"},{default:u((()=>[d(l,{class:"goods-name"},{default:u((()=>[f(p(e.name),1)])),_:2},1024),d(l,{class:"goods-spec"},{default:u((()=>[f(p(e.spec),1)])),_:2},1024),d(s,{class:"goods-price-quantity"},{default:u((()=>[d(l,{class:"goods-price"},{default:u((()=>[f("¥"+p(e.price.toFixed(2)),1)])),_:2},1024),d(l,{class:"goods-quantity"},{default:u((()=>[f("x"+p(e.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),d(l,{class:"goods-subtotal"},{default:u((()=>[f("¥"+p((e.price*e.quantity).toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),d(s,{class:"coupon-section",onClick:$},{default:u((()=>[d(l,{class:"section-label"},{default:u((()=>[f("优惠券")])),_:1}),d(s,{class:"section-value"},{default:u((()=>[P.value?(n(),o(l,{key:0},{default:u((()=>[f(p(P.value.name)+" -¥"+p(P.value.amount.toFixed(2)),1)])),_:1})):(n(),o(l,{key:1},{default:u((()=>[f("选择优惠券")])),_:1})),d(l,{class:"iconfont icon-right"})])),_:1})])),_:1}),d(s,{class:"payment-section"},{default:u((()=>[d(l,{class:"section-title"},{default:u((()=>[f("支付方式")])),_:1}),d(s,{class:"payment-options"},{default:u((()=>[(n(),_(m,null,v(J,((e,a)=>d(s,{class:"payment-option",key:a,onClick:a=>{return l=e.id,void(N.value=l);var l}},{default:u((()=>[d(s,{class:"option-left"},{default:u((()=>[d(l,{class:g(["payment-icon",e.icon])},null,8,["class"]),d(l,{class:"payment-name"},{default:u((()=>[f(p(e.name),1)])),_:2},1024)])),_:2},1024),d(s,{class:g(["option-radio",{active:N.value===e.id}])},{default:u((()=>[N.value===e.id?(n(),o(s,{key:0,class:"radio-inner"})):i("",!0)])),_:2},1032,["class"])])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1}),d(s,{class:"order-amount-section"},{default:u((()=>[d(s,{class:"amount-item"},{default:u((()=>[d(l,null,{default:u((()=>[f("商品金额")])),_:1}),d(l,null,{default:u((()=>[f("¥"+p(H.value.toFixed(2)),1)])),_:1})])),_:1}),d(s,{class:"amount-item"},{default:u((()=>[d(l,null,{default:u((()=>[f("运费")])),_:1}),d(l,null,{default:u((()=>[f("¥"+p(G.value.toFixed(2)),1)])),_:1})])),_:1}),P.value?(n(),o(s,{key:0,class:"amount-item"},{default:u((()=>[d(l,null,{default:u((()=>[f("优惠券")])),_:1}),d(l,null,{default:u((()=>[f("-¥"+p(P.value.amount.toFixed(2)),1)])),_:1})])),_:1})):i("",!0),d(s,{class:"amount-total"},{default:u((()=>[d(l,null,{default:u((()=>[f("实付金额")])),_:1}),d(l,{class:"final-price"},{default:u((()=>[f("¥"+p(R.value.toFixed(2)),1)])),_:1})])),_:1})])),_:1}),T.value?(n(),o(s,{key:0,class:"coupon-popup"},{default:u((()=>[d(s,{class:"popup-mask",onClick:z}),d(s,{class:"popup-content"},{default:u((()=>[d(s,{class:"popup-header"},{default:u((()=>[d(l,{class:"popup-title"},{default:u((()=>[f("选择优惠券")])),_:1}),d(l,{class:"close-btn",onClick:z},{default:u((()=>[f("×")])),_:1})])),_:1}),d(x,{class:"coupon-scroll","scroll-y":""},{default:u((()=>[(n(!0),_(m,null,v(O.value,((e,a)=>(n(),o(s,{class:g(["coupon-item",{active:P.value&&P.value.id===e.id}]),key:a,onClick:a=>(e=>{E.value&&E.value.id===e.id?E.value=null:E.value=e})(e)},{default:u((()=>[d(s,{class:"coupon-left"},{default:u((()=>[d(l,{class:"coupon-amount"},{default:u((()=>[f("¥"+p(e.amount.toFixed(2)),1)])),_:2},1024),e.minAmount>0?(n(),o(l,{key:0,class:"coupon-condition"},{default:u((()=>[f("满"+p(e.minAmount.toFixed(2))+"元可用",1)])),_:2},1024)):i("",!0)])),_:2},1024),d(s,{class:"coupon-right"},{default:u((()=>[d(l,{class:"coupon-name"},{default:u((()=>[f(p(e.name),1)])),_:2},1024),d(l,{class:"coupon-expire"},{default:u((()=>[f(p(e.expireDate),1)])),_:2},1024),d(l,{class:"coupon-scope"},{default:u((()=>[f(p(e.scope),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick","class"])))),128)),0===O.value.length?(n(),o(s,{key:0,class:"no-coupon"},{default:u((()=>[d(l,null,{default:u((()=>[f("暂无可用优惠券")])),_:1})])),_:1})):i("",!0)])),_:1}),d(s,{class:"popup-footer"},{default:u((()=>[d(s,{class:"cancel-btn",onClick:z},{default:u((()=>[f("取消")])),_:1}),d(s,{class:"confirm-btn",onClick:B},{default:u((()=>[f("确定")])),_:1})])),_:1})])),_:1})])),_:1})):i("",!0),d(s,{class:"submit-bar"},{default:u((()=>[d(s,{class:"total-section"},{default:u((()=>[d(l,{class:"total-label"},{default:u((()=>[f("合计:")])),_:1}),d(l,{class:"total-amount"},{default:u((()=>[f("¥"+p(R.value.toFixed(2)),1)])),_:1})])),_:1}),d(s,{class:"submit-btn",onClick:K},{default:u((()=>[f("提交订单")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-3ed05dfb"]]);export{I as default};
