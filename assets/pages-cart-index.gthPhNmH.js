import{p as e,Q as t,u as l,r as s,H as a,o as c,c as n,w as o,i as r,a as i,v as u,b as d,j as f,d as _,e as m,f as p,F as y,g,y as v,t as h,z as k,K as x,k as b,n as q}from"./index-BC-mzwrj.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=()=>{try{const t=e("cartItems");return t?JSON.parse(t):[]}catch(t){return console.error("获取购物车数据失败",t),[]}},F=s=>{try{const a=JSON.stringify(s);console.log("保存购物车数据:",a),t("cartItems"),l("cartItems",a);const c=e("cartItems"),n=!!c;return console.log("保存后验证:",n?"成功":"失败","保存的数据:",c),n}catch(a){return console.error("保存购物车数据失败",a),!1}},S=(e,t)=>{try{let l=I();const s=l.findIndex((t=>t.id===e));return s>-1&&(l[s].quantity=t,F(l),!0)}catch(l){return console.error("更新购物车商品数量失败",l),!1}},J=(e,t)=>{try{let l=I();const s=l.findIndex((t=>t.id===e));return s>-1&&(l[s].selected=t,F(l),!0)}catch(l){return console.error("更新购物车商品选中状态失败",l),!1}},N=C({__name:"index",setup(t,{expose:C}){const N=s([]),O=a((()=>0!==N.value.length&&N.value.every((e=>e.selected)))),j=a((()=>N.value.filter((e=>e.selected)).length)),w=a((()=>(()=>{try{return I().reduce(((e,t)=>t.selected?e+t.price*t.quantity:e),0)}catch(e){return console.error("获取购物车选中商品总价失败",e),0}})())),z=()=>{const e=!O.value;N.value.forEach((t=>{J(t.id,e)})),H()},E=e=>{const t=N.value.find((t=>t.id===e));t&&(t.quantity>1?(S(e,t.quantity-1),H()):x({title:"提示",content:"确定要移除这个商品吗？",success:t=>{t.confirm&&((e=>{try{const t=I().filter((t=>t.id!==e));return F(t),!0}catch(t){return console.error("从购物车移除商品失败",t),!1}})(e),H())}}))},H=()=>{try{const t=e("cartItems");if(console.log("本地存储中的购物车数据:",t),t){const e=JSON.parse(t);console.log("解析后的购物车数据:",e),N.value=e}else console.log("购物车为空"),N.value=[];console.log("购物车数据已加载, 数量:",N.value.length,"详情:",N.value)}catch(t){console.error("加载购物车数据失败",t),N.value=[]}},K=()=>{if(0===j.value)return void b({title:"请选择要结算的商品",icon:"none"});const e=N.value.filter((e=>e.selected));try{l("selected_cart_items",JSON.stringify(e)),console.log("已保存选中商品到本地存储:",e),q({url:"/pages/order/confirm-order",success:()=>{console.log("跳转到订单确认页面成功")},fail:e=>{console.error("跳转到订单确认页面失败:",e),b({title:"跳转失败，请重试",icon:"none"})}})}catch(t){console.error("保存订单数据失败:",t),b({title:"系统繁忙，请重试",icon:"none"})}},Q=()=>{k({url:"/pages/index/index"})};return c((()=>{H()})),C({onShow(){H(),console.log("购物车页面显示，重新加载数据")}}),(e,t)=>{const l=f,s=_,a=r;return i(),n(a,{class:"cart-container"},{default:o((()=>[0===N.value.length?(i(),n(a,{key:0,class:"empty-cart"},{default:o((()=>[d(l,{src:"/petpal/static/images/empty-cart.png",mode:"aspectFit",class:"empty-cart-image"}),d(s,{class:"empty-cart-text"},{default:o((()=>[m("购物车还是空的")])),_:1}),d(a,{class:"go-shopping-btn",onClick:Q},{default:o((()=>[m("去购物")])),_:1})])),_:1})):(i(),n(a,{key:1,class:"cart-content"},{default:o((()=>[d(a,{class:"cart-list"},{default:o((()=>[(i(!0),p(y,null,g(N.value,((e,t)=>(i(),n(a,{class:"cart-item",key:e.id},{default:o((()=>[d(a,{class:"checkbox",onClick:t=>(e=>{const t=N.value.find((t=>t.id===e));t&&(J(e,!t.selected),H())})(e.id)},{default:o((()=>[d(s,{class:v(["checkbox-inner",e.selected?"checked":""])},null,8,["class"])])),_:2},1032,["onClick"]),d(l,{src:e.image,mode:"aspectFill",class:"item-image"},null,8,["src"]),d(a,{class:"item-info"},{default:o((()=>[d(s,{class:"item-name"},{default:o((()=>[m(h(e.name),1)])),_:2},1024),d(s,{class:"item-spec"},{default:o((()=>[m(h(e.spec),1)])),_:2},1024),d(a,{class:"item-bottom"},{default:o((()=>[d(s,{class:"item-price"},{default:o((()=>[m("¥"+h(e.price.toFixed(2)),1)])),_:2},1024),d(a,{class:"quantity-control"},{default:o((()=>[d(s,{class:"quantity-btn",onClick:t=>E(e.id)},{default:o((()=>[m("-")])),_:2},1032,["onClick"]),d(s,{class:"quantity-value"},{default:o((()=>[m(h(e.quantity),1)])),_:2},1024),d(s,{class:"quantity-btn",onClick:t=>(e=>{const t=N.value.find((t=>t.id===e));t&&t.quantity<99&&(S(e,t.quantity+1),H())})(e.id)},{default:o((()=>[m("+")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})),N.value.length>0?(i(),n(a,{key:2,class:"settlement-bar"},{default:o((()=>[d(a,{class:"select-all",onClick:z},{default:o((()=>[d(a,{class:"checkbox"},{default:o((()=>[d(s,{class:v(["checkbox-inner",O.value?"checked":""])},null,8,["class"])])),_:1}),d(s,{class:"select-all-text"},{default:o((()=>[m("全选")])),_:1})])),_:1}),d(a,{class:"price-section"},{default:o((()=>[d(s,{class:"total-label"},{default:o((()=>[m("合计：")])),_:1}),d(s,{class:"total-price"},{default:o((()=>[m("¥"+h(w.value.toFixed(2)),1)])),_:1})])),_:1}),d(a,{class:"checkout-btn",onClick:K},{default:o((()=>[d(s,null,{default:o((()=>[m("结算("+h(j.value)+")",1)])),_:1})])),_:1})])),_:1})):u("",!0)])),_:1})}}},[["__scopeId","data-v-890862da"]]);export{N as default};
