import{r as e,H as a,c as l,w as s,i as t,a as u,b as o,v as n,e as i,t as r,d as c,I as v,y as d,x as p,s as f,h as m,k as g,u as _,D as h,n as k,E as y,A as w,z as x,G as b}from"./index-BC-mzwrj.js";import{a as V}from"./index.U0t-2fq9.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=C({__name:"account-login",setup(C){const I=e(!1),A=e(""),U=e(""),j=e(""),L=e(""),z=e(""),N=e(""),T=e(!1),D=e(!1),E=()=>{T.value=!T.value},G=()=>{D.value=!D.value},H=()=>{I.value=!I.value,J()},J=()=>{L.value="",z.value="",N.value=""},O=a((()=>I.value?""!==A.value.trim()&&""!==U.value.trim()&&""!==j.value.trim()&&!L.value&&!z.value&&!N.value:""!==A.value.trim()&&""!==U.value.trim()&&!L.value&&!z.value)),S=()=>{const e=(()=>{const e=A.value.trim();if(!e)return L.value="请输入用户名或邮箱",!1;if(I.value){if(e.length<3)return L.value="用户名至少需要3个字符",!1;const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(e.includes("@")&&!a.test(e))return L.value="邮箱格式不正确",!1}return L.value="",!0})(),a=(()=>{const e=U.value.trim();if(!e)return z.value="请输入密码",!1;if(I.value){if(e.length<6)return z.value="密码至少需要6个字符",!1;if(!/[a-zA-Z]/.test(e)||!/[0-9]/.test(e))return z.value="密码需要包含字母和数字",!1}return z.value="",!0})(),l=(()=>{if(!I.value)return!0;const e=j.value.trim();return e?e!==U.value?(N.value="两次输入的密码不一致",!1):(N.value="",!0):(N.value="请再次输入密码",!1)})();e&&a&&(!I.value||l)&&(f({title:I.value?"注册中...":"登录中..."}),I.value?V.register({username:A.value,password:U.value,email:A.value.includes("@")?A.value:""}).then((e=>{m(),g({title:"注册成功，请登录",icon:"success"}),I.value=!1,U.value="",j.value=""})).catch((e=>{m(),400===e.code&&e.message.includes("用户名已存在")?L.value="用户名已被注册":400===e.code&&e.message.includes("邮箱已存在")?L.value="邮箱已被注册":g({title:e.message||"注册失败，请重试",icon:"none"})})):V.login(A.value,U.value).then((e=>{m();const a=e.data;_("token",a.token),_("userInfo",JSON.stringify({token:a.token,userId:a.userId,nickname:a.nickname||A.value,avatar:a.avatar||"/static/images/default-avatar.png",memberLevel:a.memberLevel||"普通会员",petAvatar:a.petAvatar||"/static/images/pet.png"})),h("userLogin"),g({title:"登录成功",icon:"success"}),a.isNewUser?setTimeout((()=>{k({url:"/pages/profile/pet-info"})}),1500):setTimeout((()=>{try{const e=y();console.log("当前页面栈:",e),e.length>1?w({delta:2}):x({url:"/pages/profile/profile",fail:e=>{console.error("切换到个人中心失败:",e),b({url:"/pages/profile/profile"})}})}catch(e){console.error("导航错误:",e),x({url:"/pages/profile/profile"})}}),1500)})).catch((e=>{m(),400===e.code&&e.message.includes("用户名或密码错误")?z.value="用户名或密码错误":g({title:e.message||"登录失败，请重试",icon:"none"})})))},Z=()=>{w()},$=()=>{b({url:"/pages/login/phone-login"})};return(e,a)=>{const f=t,m=c,g=v,_=p;return u(),l(f,{class:"account-login-container"},{default:s((()=>[o(f,{class:"form-container"},{default:s((()=>[o(f,{class:"form-title"},{default:s((()=>[i(r(I.value?"账号注册":"账号登录"),1)])),_:1}),o(f,{class:"form-item"},{default:s((()=>[o(m,{class:"input-label"},{default:s((()=>[i("用户名/邮箱")])),_:1}),o(f,{class:"input-wrapper"},{default:s((()=>[o(g,{class:"username-input",type:"text",placeholder:"请输入用户名或邮箱",modelValue:A.value,"onUpdate:modelValue":a[0]||(a[0]=e=>A.value=e)},null,8,["modelValue"])])),_:1}),L.value?(u(),l(m,{key:0,class:"error-tip"},{default:s((()=>[i(r(L.value),1)])),_:1})):n("",!0)])),_:1}),o(f,{class:"form-item"},{default:s((()=>[o(m,{class:"input-label"},{default:s((()=>[i("密码")])),_:1}),o(f,{class:"input-wrapper"},{default:s((()=>[o(g,{class:"password-input",type:T.value?"text":"password",placeholder:"请输入密码",modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=e=>U.value=e)},null,8,["type","modelValue"]),o(m,{class:d(["password-toggle iconfont",T.value?"icon-eye":"icon-eye-close"]),onClick:E},null,8,["class"])])),_:1}),z.value?(u(),l(m,{key:0,class:"error-tip"},{default:s((()=>[i(r(z.value),1)])),_:1})):n("",!0)])),_:1}),I.value?(u(),l(f,{key:0,class:"form-item"},{default:s((()=>[o(m,{class:"input-label"},{default:s((()=>[i("确认密码")])),_:1}),o(f,{class:"input-wrapper"},{default:s((()=>[o(g,{class:"password-input",type:D.value?"text":"password",placeholder:"请再次输入密码",modelValue:j.value,"onUpdate:modelValue":a[2]||(a[2]=e=>j.value=e)},null,8,["type","modelValue"]),o(m,{class:d(["password-toggle iconfont",D.value?"icon-eye":"icon-eye-close"]),onClick:G},null,8,["class"])])),_:1}),N.value?(u(),l(m,{key:0,class:"error-tip"},{default:s((()=>[i(r(N.value),1)])),_:1})):n("",!0)])),_:1})):n("",!0),o(_,{class:"submit-btn",disabled:!O.value,onClick:S},{default:s((()=>[i(r(I.value?"注册":"登录"),1)])),_:1},8,["disabled"]),o(f,{class:"switch-mode"},{default:s((()=>[o(m,{onClick:H},{default:s((()=>[i(r(I.value?"已有账号？点击登录":"没有账号？点击注册"),1)])),_:1})])),_:1}),o(f,{class:"other-login-options"},{default:s((()=>[o(m,{class:"divider-text"},{default:s((()=>[i("其他登录方式")])),_:1}),o(f,{class:"other-options"},{default:s((()=>[o(f,{class:"option-item",onClick:Z},{default:s((()=>[o(m,{class:"option-icon iconfont icon-wechat"}),o(m,{class:"option-text"},{default:s((()=>[i("微信")])),_:1})])),_:1}),o(f,{class:"option-item",onClick:$},{default:s((()=>[o(m,{class:"option-icon iconfont icon-phone"}),o(m,{class:"option-text"},{default:s((()=>[i("手机号")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a82fb8d9"]]);export{I as default};
